% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/KM_diff.R, R/km_wlr_calculations_helpers.R
\name{KM_diff}
\alias{KM_diff}
\title{Kaplan-Meier Difference Between Groups}
\usage{
KM_diff(
  df,
  tte.name = "tte",
  event.name = "event",
  treat.name = "treat",
  weight.name = NULL,
  at_points = sort(df[[tte.name]]),
  alpha = 0.05,
  seedstart = 8316951,
  draws = 0,
  risk.points,
  draws.band = 0,
  tau.seq = 0.25,
  qtau = 0.025,
  show_resamples = TRUE,
  modify_tau = FALSE
)

KM_diff(
  df,
  tte.name = "tte",
  event.name = "event",
  treat.name = "treat",
  weight.name = NULL,
  at_points = sort(df[[tte.name]]),
  alpha = 0.05,
  seedstart = 8316951,
  draws = 0,
  risk.points,
  draws.band = 0,
  tau.seq = 0.25,
  qtau = 0.025,
  show_resamples = TRUE,
  modify_tau = FALSE
)
}
\arguments{
\item{df}{Data frame with survival data.}

\item{tte.name}{Name of time-to-event variable.}

\item{event.name}{Name of event indicator variable.}

\item{treat.name}{Name of treatment group variable.}

\item{weight.name}{Name of weights variable.}

\item{at_points}{Time points for calculation.}

\item{alpha}{Significance level.}

\item{seedstart}{Random seed.}

\item{draws}{Number of resampling draws.}

\item{risk.points}{Risk points for calculation.}

\item{draws.band}{Number of draws for simultaneous bands.}

\item{tau.seq}{Step size for tau sequence.}

\item{qtau}{Quantile for tau range.}

\item{show_resamples}{Logical; whether to plot resamples.}

\item{modify_tau}{Logical; restrict time range for bands.}
}
\value{
A list containing:
\describe{
\item{at_points}{Time points used in calculations}
\item{surv0, surv1}{Survival estimates for control and treatment groups}
\item{sig2_surv0, sig2_surv1}{Variance estimates for survival curves}
\item{dhat}{Survival difference (S1 - S0) at each time point}
\item{sig2_dhat}{Variance of survival difference}
\item{lower, upper}{Pointwise confidence limits (1 - alpha/2)}
\item{sb_lower, sb_upper}{Simultaneous band limits (if draws.band > 0)}
\item{c_alpha_band}{Critical value for simultaneous band (if draws.band > 0)}
\item{dhat_star}{Matrix of resampled differences (if draws.band > 0)}
\item{Zdhat_star}{Standardized resampled differences (if draws.band > 0)}
}

Data frame with KM differences and confidence intervals.
}
\description{
Calculates the difference in Kaplan-Meier curves between two groups, with confidence
intervals and optional resampling-based simultaneous confidence bands.

Calculates the difference in KM curves between two groups, with confidence intervals and optional resampling bands.
}
\details{
This function computes the difference in Kaplan-Meier survival curves, \eqn{\delta(t) = S_1(t) - S_0(t)},
along with variance estimates and confidence intervals.

When \code{draws.band > 0}, simultaneous confidence bands are constructed using
the supremum distribution of the standardized difference process. These bands
maintain the specified coverage probability across all time points simultaneously.

The variance is estimated using Greenwood's formula for unweighted data, or
resampling-based methods when \code{draws > 0}.
}
\note{
Treatment must be coded as 0=control, 1=experimental. Event must be binary (0/1).
}
\section{Confidence Intervals vs Bands}{

\itemize{
\item Pointwise CIs (\code{lower}, \code{upper}): Cover the true difference at each time point with probability 1-alpha
\item Simultaneous bands (\code{sb_lower}, \code{sb_upper}): Cover the entire difference curve with probability 1-alpha
}
}

\examples{
\dontrun{
library(survival)
data(veteran)
veteran$treat <- as.numeric(veteran$trt) - 1

# Basic KM difference
result <- KM_diff(
  df = veteran,
  tte.name = "time",
  event.name = "status",
  treat.name = "treat"
)

# Plot the difference
plot(result$at_points, result$dhat, type = "s",
     xlab = "Time", ylab = "Survival Difference")

# With simultaneous confidence bands
result_band <- KM_diff(
  df = veteran,
  tte.name = "time",
  event.name = "status",
  treat.name = "treat",
  draws.band = 1000,
  modify_tau = TRUE
)
}

}
\seealso{
\code{\link{df_counting}} for full survival analysis
\code{\link{plotKM.band_subgroups}} for visualization
\code{\link{cumulative_rmst_bands}} for RMST analysis

Other survival_analysis: 
\code{\link{cox_rhogamma}()},
\code{\link{df_counting}()},
\code{\link{wt.rg.S}()}
}
\concept{plotting_functions}
\concept{survival_analysis}
